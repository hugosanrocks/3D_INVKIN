# --- MASTER Makefile for the INTERPOLATION library
include ../Makefile.inc

SOURCES = $(wildcard ./src/*.f90)
OBJECTS = $(SOURCES:.f90=.o) 
LIST = $(wildcard ./demo/test_*)
EXCEPT = ./demo/test_dft_2d_new 
#  ./demo/test_dft_2d_new => lack interp_type.h
DEMO = $(filter-out $(EXCEPT),$(LIST)) 

lib : $(OBJECTS) 
	$(AR) $(ARFUNCT) ./lib/libSEISCOPE_INTERP.a $(OBJECTS)

./src/%.o : ./src/%.f90
	$(FC) $(FFLAGS) -c -o $@ $<

clean :	
	$(RM) -r ./src/*.o  *~ *backup *.mod *genmod* ./lib/*.a 

test :
	@echo "In each test case you can :"
	@echo "  - Type 'scons view' to visualize the results with Madagascar"
	@echo "  - Type 'scons -c'   to remove intermediate files generated by Madagascar" 
	for d in $(DEMO) ; do $(MAKE) -C $$d test ; done

testclean : 
	for d in $(DEMO) ; do $(MAKE) -C $$d testclean ; done

distclean : clean testclean

help : 
	@echo 'Usage: make lib test [GNU=1]'
	@echo '       make distclean [GNU=1]'
